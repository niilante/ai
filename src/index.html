<!DOCTYPE html>
<html ng-app="app">
<head lang="en">
    <meta charset="UTF-8">
    <title>{{title}}</title>
    <base href="/"/>
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/ai.css"/>
    <style type="text/css">
        .btn-close{
            text-align: center;
            width: 20px;
            height: 20px;
            position: absolute;
            top: 8px;
            right: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <a ng-show="showBack()" href="/" class="btn btn-primary pull-right" style="margin-top: 12px;">Return Home</a>
        <div ng-view></div>
    </div>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.3/angular.min.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.3/angular-route.min.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.3/angular-sanitize.min.js"></script>
    <script type="text/javascript" src="ai.js"></script>
    <script type="text/ng-template" id="/home.html">
        <h2>Ai<small> - Angular Interface</small></h2>
        <p>
            The Ai library is a collection of tools to assist in building Angular applications quickly while maintaining
            good project structure with simplified syntax. Along with the "register.js" module among others with
            effortlessly enhance your project with commonly used UI providers and directives.
        </p>
        <p>
            Click on any of the below modules to view documentation and examples.
        </p>
        <dl ng-repeat="(key, value) in items">
            <dt><a href="{{key}}">{{key | areaName}}</a></dt><dd>{{value}}</dd>
        </dl>
    </script>
    <script type="text/javascript">

        var app, tmpAreas, keys, areas;
        tmpAreas = {
            '/register': 'Angular application registration helper',
            '/passport': 'Simplifies handling authentication within Angular app.',
            '/storage': 'Use local storage with auto cookie fallback.',
            '/autoform': 'Handy during dev to quickly create a form.',
            '/dropdown': 'Advanced customizable dropdown directive.',
            '/flash': 'Allows for showing flash/popup messages.',
            '/modal': 'Native modal dialog.',
            '/table': 'Bind local or remote data to table/grid.',
            '/validate': 'Form validation with auto model binding.',
            '/viewer': 'Animated slide transitions for views.',
            '/widget': 'Various widgets - case, nicescroll, redactor, decimal, input mask & compare.'
        };

        // sort areas.
        keys = Object.keys(tmpAreas).sort();
        areas = {};
        angular.forEach(keys, function (k) {
            areas[k] = tmpAreas[k];
        });

        app = angular.module('app', ['ngRoute', 'ai.table']);
        app.config(['$routeProvider', '$locationProvider', function ($routeProvider, $locationProvider) {
            $routeProvider.when('/', { templateUrl: '/home.html', controller: 'Controller', title: 'Ai' });
            angular.forEach(areas, function (v, k) {
                var config, cap;
                cap = k.replace('/', '');
                cap = cap.charAt(0).toUpperCase() + cap.slice(1);
                config = { templateUrl: '/' + cap.toLowerCase() + '/example' + k + '.html',
                    controller: 'Controller', title: 'Ai ' + cap };
                $routeProvider.when(k, config);
            });
            $locationProvider.html5Mode(true);
        }]);

        app.run(['$rootScope', function ($rootScope) {
            $rootScope.msg = '';
            $rootScope.close = function () {
                $rootScope.msg = '';
            };
            $rootScope.showBack = function () {
                return $rootScope.title !== 'Ai';
            };
            $rootScope.$on('$routeChangeSuccess', function (event, current) {
                $rootScope.title = current.$$route.title;
            });
        }]);

        app.filter('areaName', function () {
            return function (val){
                val = val.replace('/', '');
                return val.charAt(0).toUpperCase() + val.slice(1);
            }
        });

        app.controller('Controller', ['$rootScope', '$scope', '$route', function ($rootScope, $scope, $route) {

            var current = $route.current,
                route = current.$$route,
                params = current.params,
                path = route.originalPath,
                area = path && path !== '/' ? path.replace('/', '') : 'home',
                msg, close;

            close = $rootScope.close;

            // home
            if(area === 'home'){
                $scope.items = areas;
            }

            // table
            if(area === 'table'){
                $scope.tbl = {
                    colums: {
                        name: { editType: 'text' },
                        email: { editType: 'text' }
                    },
                    source: [
                        { name: 'Jim Thomas', email: 'jthomas@gmail.com'},
                        { name: 'Bob Blair', email: 'bblair@aol.com'},
                        { name: 'Randy Quick', email: 'randy.quick@yahoo.com'},
                    ],
                    orderBy: [ '-name' ],
                    selectable: true,
                    exportable: true,
                    hover: true,
                    goto: false,
                    onSelected: function (row, selected, e) {
                        $rootScope.msg = JSON.stringify(selected);
                    },
                    onReset: function () {
                        $rootScope.msg = 'Table was reset.';
                    },
                    beforeFilter: function (source, q){
                        $rootScope.msg = 'Table filtered using query: ' + q;
                    }
                }
            }

        }]);

    </script>
</body>
</html>